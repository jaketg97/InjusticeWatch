---
title: "Slattery Boyle Sentencing Analysis"
author: "Jacob Gosselin"
date: "7/24/2018"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(mosaic)
library(readr)
library(plyr)
library(plotrix)
library(boot)
```
Hi there! What follows is a written out methodology for Injustice Watch's sentencing analysis on Maura Slattery Boyle. All work was done in R. We've also included the link to download the R Markdown file directly; since our data is read in from the Cook County Online Data portal, our work can easily be re-created or expanded upon. Thanks!

# Reading in Data/Converting Sentence Term

We'll start by reading in our original sentencing data (from https://datacatalog.cookcountyil.gov/Courts/Sentencing/tg8v-tm6u). We'll then create a conversion table to standardize our units (i.e. years=1, months=1/12, weeks=1/52, days=1/365, all other units are left undefined but rows are kept). We'll then convert our sentence (i.e. 6 months=.5), and store it under a new variable, "converted_sentence".
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
#original <- read_csv("/Volumes/GoogleDrive/My Drive/Injustice Watch/sentencing/Sentencing.csv")
original <- read_csv("https://datacatalog.cookcountyil.gov/api/views/tg8v-tm6u/rows.csv?accessType=DOWNLOAD")
conversion_table <- revalue(original$COMMITMENT_UNIT, c("Year(s)"=1, "Months"=1/12, "Weeks"=1/52, "Days"=1/365, "Natural Life"=100, "Pounds"=NA, "Dollars"=NA, "Term"=NA))
conversion_table <- as.double(conversion_table)
original["converted_sentence"]=conversion_table*original$COMMITMENT_TERM
```
#Creation of Hispanic Race
In case you want to do any deeper racial analyis (we'll be dealing solely in Black defendants v. White defendants here), it's necesarry to standardize the race codes in regards to Latinx defendants. We've assigned both "White [Hisanic or Latino]" and "Black [Hispanic or Latino]" to one category, Hispanic.
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
x<-revalue(original$RACE, c("White [Hispanic or Latino]"="HISPANIC", "White/Black [Hispanic or Latino]"="HISPANIC"))
original["race2"]=x
```
#Creating relevant subsets

We'll now create a series of subsets, to find median sentences. We're going to create a subset for Class 1, 2, 3, 4, and X felonies. This will exclude 2792 cases, which are filed under Class A, B, C, M, O, P, U, or Z felonies. A lot of these are mistaken filings, but we don't want to assign them. Since the sample size is large, we're better of ignoring them (they only make up <2% of cases). 

We're also going to create further subsets (PJ) for sentences to Prison or Jail. We'll use these to find median sentences; while it eliminates a good chunk of our cases (~41%), you have to do this to get an accurate read on median sentence time. Otherwise, a two year probation will skew our median, since that will be considered harsher than a one year prison sentence. 

We'll also create a subset of just Slattery-Boyle's sentences.
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
class_1 <- subset(original, CLASS=="1")
class_2 <- subset(original, CLASS=="2")
class_3 <- subset(original, CLASS=="3")
class_4 <- subset(original, CLASS=="4")
class_X <- subset(original, CLASS=="X") 
class_1_PJ <- subset(original, CLASS=="1" & (SENTENCE_TYPE=="Prison" | SENTENCE_TYPE=="Jail"))
class_2_PJ <- subset(original, CLASS=="2" & (SENTENCE_TYPE=="Prison" | SENTENCE_TYPE=="Jail"))
class_3_PJ <- subset(original, CLASS=="3" & (SENTENCE_TYPE=="Prison" | SENTENCE_TYPE=="Jail"))
class_4_PJ <- subset(original, CLASS=="4" & (SENTENCE_TYPE=="Prison" | SENTENCE_TYPE=="Jail"))
class_X_PJ <- subset(original, CLASS=="X" & (SENTENCE_TYPE=="Prison" | SENTENCE_TYPE=="Jail"))
original_PJ <- subset(original, SENTENCE_TYPE=="Prison" | SENTENCE_TYPE=="Jail")
boyle <- subset(original, SENTENCE_JUDGE=="Maura  Slattery Boyle")
median_1 <- median(class_1_PJ$converted_sentence, na.rm=TRUE)
median_2 <- median(class_2_PJ$converted_sentence, na.rm=TRUE)
median_3 <- median(class_3_PJ$converted_sentence, na.rm=TRUE)
median_4 <- median(class_4_PJ$converted_sentence, na.rm=TRUE)
median_X <- median(class_X_PJ$converted_sentence, na.rm=TRUE)
median_1 
median_2 
median_3 
median_4 
median_X
```
The outputs are our median prison sentences by Felony Class.

#Analysis 1: Sentencings Above the Median (Prison or Jail only)

We'll start by finding how often Slattery Boyle rules above the median generally. This means going through each case that resulted in prison time and seeing if the sentence is above the median for that felony class. To make life easier, we're going to create a subset boyle_PJ that's Slattery Boyle cases resulting in prison or jail time. We're also going to do the same thing, but with our entire data set, so we get a sense of how the "average" Cook County judge rules by comparison.

```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
boyle_PJ <- subset(boyle, SENTENCE_TYPE=="Prison" | SENTENCE_TYPE=="Jail")
boyle_above <- sum(boyle_PJ$CLASS=="1" & boyle_PJ$converted_sentence>median_1 | boyle_PJ$CLASS=="2" & boyle_PJ$converted_sentence>median_2 | boyle_PJ$CLASS=="3" & boyle_PJ$converted_sentence>median_3 | boyle_PJ$CLASS=="4" & boyle_PJ$converted_sentence>median_4 | boyle_PJ$CLASS=="X" & boyle_PJ$converted_sentence>median_X, na.rm=TRUE)
boyle_total<-sum(boyle_PJ$CLASS=="1" | boyle_PJ$CLASS=="2" | boyle_PJ$CLASS=="3" | boyle_PJ$CLASS=="4" | boyle_PJ$CLASS=="X", na.rm=TRUE)
boyle_above/boyle_total
overall_above <- sum(original_PJ$CLASS=="1" & original_PJ$converted_sentence>median_1 | original_PJ$CLASS=="2" & original_PJ$converted_sentence>median_2 | original_PJ$CLASS=="3" & original_PJ$converted_sentence>median_3 | original_PJ$CLASS=="4" & original_PJ$converted_sentence>median_4 | original_PJ$CLASS=="X" & original_PJ$converted_sentence>median_X, na.rm=TRUE)
overall_total <- sum(original_PJ$CLASS=="1" | original_PJ$CLASS=="2" | original_PJ$CLASS=="3" | original_PJ$CLASS=="4" | original_PJ$CLASS=="X", na.rm=TRUE)
overall_above/overall_total
```
This first result is the percentage of Slattery-Boyle prison/jail sentences above the median, the second result is the percentage of prison/jail sentences above the median for the average Cook County judge.

#Analysis 2: Racial Impact on Sentencings Above the Median (Prison or Jail only)

Now we'll start breaking our data down by race. Here we'll look at the percentage of times Slattery Boyle is ruling above the median for Black defendants (who make up the VAST majority of her cases), vs. the percentage of times judges generally rule above the median for Black defendants.
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
boyle_black_above <- sum(boyle_PJ$RACE=="Black" & (boyle_PJ$CLASS=="1" & boyle_PJ$converted_sentence>median_1 | boyle_PJ$CLASS=="2" & boyle_PJ$converted_sentence>median_2 | boyle_PJ$CLASS=="3" & boyle_PJ$converted_sentence>median_3 | boyle_PJ$CLASS=="4" & boyle_PJ$converted_sentence>median_4 | boyle_PJ$CLASS=="X" & boyle_PJ$converted_sentence>median_X), na.rm=TRUE)
boyle_black_total<-sum(boyle_PJ$RACE=="Black" & (boyle_PJ$CLASS=="1" | boyle_PJ$CLASS=="2" | boyle_PJ$CLASS=="3" | boyle_PJ$CLASS=="4" | boyle_PJ$CLASS=="X"), na.rm=TRUE)
boyle_black_above/boyle_black_total
overall_black_above <- sum(original_PJ$RACE=="Black" & (original_PJ$CLASS=="1" & original_PJ$converted_sentence>median_1 | original_PJ$CLASS=="2" & original_PJ$converted_sentence>median_2 | original_PJ$CLASS=="3" & original_PJ$converted_sentence>median_3 | original_PJ$CLASS=="4" & original_PJ$converted_sentence>median_4 | original_PJ$CLASS=="X" & original_PJ$converted_sentence>median_X), na.rm=TRUE)
overall_black_total <- sum(original_PJ$RACE=="Black" & (original_PJ$CLASS=="1" | original_PJ$CLASS=="2" | original_PJ$CLASS=="3" | original_PJ$CLASS=="4" | original_PJ$CLASS=="X"), na.rm=TRUE)
overall_black_above/overall_black_total
```
This first result is the percentage of Slattery Boyle prison/jail sentences above the median with Black defendants; the second result is the percentage of prison/jail sentences above the median for the average Cook County judge with Black defendants.

Now we'll look at white defendants.
```{r}
boyle_white_above <- sum(boyle_PJ$RACE=="White" & (boyle_PJ$CLASS=="1" & boyle_PJ$converted_sentence>median_1 | boyle_PJ$CLASS=="2" & boyle_PJ$converted_sentence>median_2 | boyle_PJ$CLASS=="3" & boyle_PJ$converted_sentence>median_3 | boyle_PJ$CLASS=="4" & boyle_PJ$converted_sentence>median_4 | boyle_PJ$CLASS=="X" & boyle_PJ$converted_sentence>median_X), na.rm=TRUE)
boyle_white_total<-sum(boyle_PJ$RACE=="White" & (boyle_PJ$CLASS=="1" | boyle_PJ$CLASS=="2" | boyle_PJ$CLASS=="3" | boyle_PJ$CLASS=="4" | boyle_PJ$CLASS=="X"), na.rm=TRUE)
boyle_white_above/boyle_white_total
overall_white_above <- sum(original_PJ$RACE=="White" & (original_PJ$CLASS=="1" & original_PJ$converted_sentence>median_1 | original_PJ$CLASS=="2" & original_PJ$converted_sentence>median_2 | original_PJ$CLASS=="3" & original_PJ$converted_sentence>median_3 | original_PJ$CLASS=="4" & original_PJ$converted_sentence>median_4 | original_PJ$CLASS=="X" & original_PJ$converted_sentence>median_X), na.rm=TRUE)
overall_white_total <- sum(original_PJ$RACE=="White" & (original_PJ$CLASS=="1" | original_PJ$CLASS=="2" | original_PJ$CLASS=="3" | original_PJ$CLASS=="4" | original_PJ$CLASS=="X"), na.rm=TRUE)
overall_white_above/overall_white_total
```
This first result is the percentage of Slattery-Boyle prison/jail sentences above the median with white defendants, the second result is the percentage of prison/jail sentences above the median for the average Cook County judge with white defendants. Worth noting here that there are VERY few white defendants seen by Slattery Boyle, or by Cook County judges generally. This is why we don't mention the racial discrepancy shown here in our piece; though it certainly exists, it's hard to say whether it's statistically significant, since our sample size of White defendants is so small.

#Analysis 3: Sentencing Type Overall

Alright now let's take a look at how sentencing type breaks down (specifically probation vs. prison). We're only going to look at Class 1, 2, 3, and 4 felonies (Class X felonies almost always result in prison time anyways). First we'll do overall breakdowns vs. Slattery-Boyle breakdowns. 
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
#overall
class_1_row=c(sum(class_1$SENTENCE_TYPE=="Probation"), nrow(class_1_PJ), nrow(class_1))
class_2_row=c(sum(class_2$SENTENCE_TYPE=="Probation"), nrow(class_2_PJ), nrow(class_2))
class_3_row=c(sum(class_3$SENTENCE_TYPE=="Probation"), nrow(class_3_PJ), nrow(class_3))
class_4_row=c(sum(class_4$SENTENCE_TYPE=="Probation"), nrow(class_4_PJ), nrow(class_4))
labels=c("Class 1", "Class 2", "Class 3", "Class 4")
overall_sentencing_percents=data.frame(class_1_row,class_2_row,class_3_row, class_4_row)
write.csv(overall_sentencing_percents,"~/Desktop/overall_sentencing_percents.csv")

#boyle
boyle_1_row=c(sum(boyle$CLASS=="1" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$CLASS=="1", na.rm=TRUE), sum(boyle$CLASS=="1", na.rm=TRUE))
boyle_2_row=c(sum(boyle$CLASS=="2" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$CLASS=="2", na.rm=TRUE), sum(boyle$CLASS=="2", na.rm=TRUE))
boyle_3_row=c(sum(boyle$CLASS=="3" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$CLASS=="3", na.rm=TRUE), sum(boyle$CLASS=="3", na.rm=TRUE))
boyle_4_row=c(sum(boyle$CLASS=="4" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$CLASS=="4", na.rm=TRUE), sum(boyle$CLASS=="4", na.rm=TRUE))
boyle_sentencing_percents=data.frame(boyle_1_row,boyle_2_row,boyle_3_row, boyle_4_row)
write.csv(boyle_sentencing_percents,"~/Desktop/boyle_sentencing_percents.csv")
```
We exported our findings to a CSV.

#Analysis 4: Sentencing Type Racial Breakdown

Now we'll do the same thing but with Black defendants and white defendants.
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
#black
boyle_black1_row=c(sum(boyle$RACE=="Black" & boyle$CLASS=="1" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$RACE=="Black" & boyle_PJ$CLASS=="1", na.rm=TRUE), sum(boyle$RACE=="Black" & boyle$CLASS=="1", na.rm=TRUE))
boyle_black2_row=c(sum(boyle$RACE=="Black" & boyle$CLASS=="2" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$RACE=="Black" & boyle_PJ$CLASS=="2", na.rm=TRUE), sum(boyle$RACE=="Black" & boyle$CLASS=="2", na.rm=TRUE))
boyle_black3_row=c(sum(boyle$RACE=="Black" & boyle$CLASS=="3" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$RACE=="Black" & boyle_PJ$CLASS=="3", na.rm=TRUE), sum(boyle$RACE=="Black" & boyle$CLASS=="3", na.rm=TRUE))
boyle_black4_row=c(sum(boyle$RACE=="Black" & boyle$CLASS=="4" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$RACE=="Black" & boyle_PJ$CLASS=="4", na.rm=TRUE), sum(boyle$RACE=="Black" & boyle$CLASS=="4", na.rm=TRUE))
boyle_black_sentencing_percents=data.frame(boyle_black1_row,boyle_black2_row,boyle_black3_row, boyle_black4_row)
write.csv(boyle_black_sentencing_percents,"~/Desktop/boyle_black_sentencing_percents.csv")

#white
boyle_white1_row=c(sum(boyle$RACE=="White" & boyle$CLASS=="1" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$RACE=="White" & boyle_PJ$CLASS=="1", na.rm=TRUE), sum(boyle$RACE=="White" & boyle$CLASS=="1", na.rm=TRUE))
boyle_white2_row=c(sum(boyle$RACE=="White" & boyle$CLASS=="2" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$RACE=="White" & boyle_PJ$CLASS=="2", na.rm=TRUE), sum(boyle$RACE=="White" & boyle$CLASS=="2", na.rm=TRUE))
boyle_white3_row=c(sum(boyle$RACE=="White" & boyle$CLASS=="3" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$RACE=="White" & boyle_PJ$CLASS=="3", na.rm=TRUE), sum(boyle$RACE=="White" & boyle$CLASS=="3", na.rm=TRUE))
boyle_white4_row=c(sum(boyle$RACE=="White" & boyle$CLASS=="4" & boyle$SENTENCE_TYPE=="Probation", na.rm=TRUE),sum(boyle_PJ$RACE=="White" & boyle_PJ$CLASS=="4", na.rm=TRUE), sum(boyle$RACE=="White" & boyle$CLASS=="4", na.rm=TRUE))
boyle_white_sentencing_percents=data.frame(boyle_white1_row,boyle_white2_row,boyle_white3_row, boyle_white4_row)
write.csv(boyle_white_sentencing_percents,"~/Desktop/boyle_white_sentencing_percents.csv")
```
We exported our findings to a CSV.

#Significance Tests

Now we'll test the statistical significance of the disparity between Slattery Boyle's sentencing and the average judge's sentencing. We'll only be doing this with Prison/Jail sentences above the median (since we have an overall measure). We'll do this using the Bootstrap Method; we'll take Slattery-Boyle's Prison/Jail subset, and construct a 95th Percentile Confidence Interval from re-sampling. We're going to slim down our dataset before we do this (bootstrap re-sampling takes a decent amount of processing power, and I'm working with an 11-inch Macbook Air I bought refurbished). 
```{r, tidy=TRUE, tidy.opts=list(width.cutoff=60)}
boyle_PJ_2<-c(boyle_PJ["CLASS"], boyle_PJ["converted_sentence"])
boyle_PJ_2<-data.frame(boyle_PJ_2)
f_abovemedian<-function(data,indices){
  sample1<-data[indices,]
  sum(sample1$CLASS=="1" & sample1$converted_sentence>median_1 | sample1$CLASS=="2" & sample1$converted_sentence>median_2 | sample1$CLASS=="3" & sample1$converted_sentence>median_3 | sample1$CLASS=="4" & sample1$converted_sentence>median_4 | sample1$CLASS=="X" & sample1$converted_sentence>median_X, na.rm=TRUE) / sum(sample1$CLASS=="1" | sample1$CLASS=="2" | sample1$CLASS=="3" | sample1$CLASS=="4" | sample1$CLASS=="X", na.rm=TRUE)
}
boyle_PJ_boot<-boot(boyle_PJ_2, f_abovemedian, R=6000)
plot(boyle_PJ_boot)
boot.ci(boyle_PJ_boot)
```
Our 95% Confidence interval is roughly 0.537-0.581. What this means is that if there was no difference between Slattery Boyle and the average Cook County judge, there's a 95% chance that the overall rate of sentencing above the median would be between 53% and 58%. However, our actual overall rate is 46.9%, squarely outside that range. In other words, we've just ruled out statistical randomness in the discrepancy between Slattery Boyle's sentences, and those of the average Cook County judge. For reference, 5% is a widely used significance value when it comes to public policy data. 

That's it! Again, the R Markdown file itself is available for download below our article, and can be used to recreate our findings or build upon our work for further analysis of sentencing by Cook County judges. Thanks to Cook County State's Attorney Kim Foxx for making this data available to the public. Any further questions about our analysis can be directed to jacobgosselin@uchicago.edu. 
